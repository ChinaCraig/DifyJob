<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>分页测试</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div class="container mt-4">
        <h2>分页功能测试</h2>
        
        <div class="card">
            <div class="card-header">
                <h5>日志列表</h5>
            </div>
            <div class="card-body">
                <div id="logsTable">
                    <!-- 日志表格将在这里显示 -->
                </div>
                
                <!-- 分页控件 -->
                <div class="d-flex justify-content-between align-items-center mt-3" id="paginationWrapper" style="display: none;">
                    <div class="text-muted" id="statsInfo">
                        <!-- 统计信息 -->
                    </div>
                    <nav>
                        <ul class="pagination pagination-sm mb-0" id="logsPagination">
                            <!-- 分页按钮 -->
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentPage = 1;
        const perPage = 5;

        // 加载日志数据
        async function loadLogs(page = 1) {
            try {
                const response = await axios.get(`http://localhost:5001/api/logs?page=${page}&per_page=${perPage}`);
                const data = response.data;
                
                // 更新表格
                updateTable(data.logs);
                
                // 更新分页
                updatePagination(data);
                
                currentPage = page;
                
            } catch (error) {
                console.error('加载失败:', error);
                document.getElementById('logsTable').innerHTML = `
                    <div class="alert alert-danger">加载失败: ${error.message}</div>
                `;
            }
        }

        // 更新表格
        function updateTable(logs) {
            if (logs.length === 0) {
                document.getElementById('logsTable').innerHTML = `
                    <div class="text-center text-muted py-4">
                        <p>暂无数据</p>
                    </div>
                `;
                return;
            }

            let tableHtml = `
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>执行时间</th>
                            <th>时间范围</th>
                            <th>状态</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            logs.forEach(log => {
                const executeTime = new Date(log.execute_time);
                const startTime = new Date(log.start_time);
                const endTime = new Date(log.end_time);
                
                tableHtml += `
                    <tr>
                        <td>${log.id}</td>
                        <td>${executeTime.toLocaleString()}</td>
                        <td>
                            <small>
                                ${startTime.toLocaleTimeString()} - 
                                ${endTime.toLocaleTimeString()}
                            </small>
                        </td>
                        <td>
                            <span class="badge ${log.status === 'success' ? 'bg-success' : 'bg-danger'}">
                                ${log.status === 'success' ? '成功' : '失败'}
                            </span>
                        </td>
                    </tr>
                `;
            });

            tableHtml += `
                    </tbody>
                </table>
            `;

            document.getElementById('logsTable').innerHTML = tableHtml;
        }

        // 更新分页
        function updatePagination(pagination) {
            const paginationWrapper = document.getElementById('paginationWrapper');
            const paginationContainer = document.getElementById('logsPagination');
            const statsInfo = document.getElementById('statsInfo');
            
            if (pagination.pages <= 1) {
                paginationWrapper.style.display = 'none';
                return;
            }
            
            paginationWrapper.style.display = 'flex';
            
            // 更新统计信息
            const start = (pagination.current_page - 1) * pagination.per_page + 1;
            const end = Math.min(pagination.current_page * pagination.per_page, pagination.total);
            statsInfo.textContent = `显示第 ${start} - ${end} 条，共 ${pagination.total} 条记录`;
            
            // 生成分页按钮
            let paginationHtml = '';
            
            // 上一页
            if (pagination.has_prev) {
                paginationHtml += `
                    <li class="page-item">
                        <a class="page-link" href="#" onclick="loadLogs(${pagination.current_page - 1})">
                            <i class="bi bi-chevron-left"></i>
                        </a>
                    </li>
                `;
            } else {
                paginationHtml += `
                    <li class="page-item disabled">
                        <span class="page-link"><i class="bi bi-chevron-left"></i></span>
                    </li>
                `;
            }
            
            // 页码
            for (let i = 1; i <= pagination.pages; i++) {
                if (i === pagination.current_page) {
                    paginationHtml += `
                        <li class="page-item active">
                            <span class="page-link">${i}</span>
                        </li>
                    `;
                } else {
                    paginationHtml += `
                        <li class="page-item">
                            <a class="page-link" href="#" onclick="loadLogs(${i})">${i}</a>
                        </li>
                    `;
                }
            }
            
            // 下一页
            if (pagination.has_next) {
                paginationHtml += `
                    <li class="page-item">
                        <a class="page-link" href="#" onclick="loadLogs(${pagination.current_page + 1})">
                            <i class="bi bi-chevron-right"></i>
                        </a>
                    </li>
                `;
            } else {
                paginationHtml += `
                    <li class="page-item disabled">
                        <span class="page-link"><i class="bi bi-chevron-right"></i></span>
                    </li>
                `;
            }
            
            paginationContainer.innerHTML = paginationHtml;
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadLogs(1);
        });
    </script>
</body>
</html> 