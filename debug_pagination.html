<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>分页调试</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div class="container mt-4">
        <h2>分页调试</h2>
        
        <div class="row">
            <div class="col-md-6">
                <button onclick="testAPI()" class="btn btn-primary mb-3">测试API</button>
                <div id="apiResult"></div>
            </div>
            <div class="col-md-6">
                <button onclick="testPagination()" class="btn btn-success mb-3">测试分页显示</button>
                <div id="paginationResult"></div>
            </div>
        </div>
        
        <!-- 分页控件 -->
        <div class="d-flex justify-content-between align-items-center mt-3" id="paginationWrapper" style="display: none;">
            <div class="text-muted" id="paginationStats">
                <!-- 统计信息 -->
            </div>
            <nav>
                <ul class="pagination pagination-sm mb-0" id="logsPagination">
                    <!-- 分页按钮 -->
                </ul>
            </nav>
        </div>
    </div>

    <script>
        async function testAPI() {
            try {
                const response = await axios.get('http://localhost:5001/api/logs?page=1&per_page=10');
                const data = response.data;
                
                document.getElementById('apiResult').innerHTML = `
                    <div class="alert alert-info">
                        <h6>API响应:</h6>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
                
            } catch (error) {
                document.getElementById('apiResult').innerHTML = `
                    <div class="alert alert-danger">API错误: ${error.message}</div>
                `;
            }
        }

        async function testPagination() {
            try {
                const response = await axios.get('http://localhost:5001/api/logs?page=1&per_page=10');
                const pagination = response.data;
                
                console.log('分页数据:', pagination);
                
                // 测试分页更新
                updateLogsPagination(pagination);
                
                document.getElementById('paginationResult').innerHTML = `
                    <div class="alert alert-success">
                        <h6>分页测试完成</h6>
                        <p>总记录: ${pagination.total}</p>
                        <p>总页数: ${pagination.pages}</p>
                        <p>当前页: ${pagination.current_page}</p>
                        <p>检查下方是否显示分页控件</p>
                    </div>
                `;
                
            } catch (error) {
                document.getElementById('paginationResult').innerHTML = `
                    <div class="alert alert-danger">分页测试失败: ${error.message}</div>
                `;
            }
        }

        // 更新分页控件
        function updateLogsPagination(pagination) {
            console.log('开始更新分页控件');
            console.log('分页数据:', pagination);
            
            const paginationContainer = document.getElementById('logsPagination');
            const paginationWrapper = document.getElementById('paginationWrapper');
            const paginationStats = document.getElementById('paginationStats');
            
            console.log('分页容器:', paginationContainer);
            console.log('分页包装器:', paginationWrapper);
            console.log('统计元素:', paginationStats);
            
            if (!paginationContainer || !paginationWrapper) {
                console.log('缺少必要元素');
                return;
            }
            
            if (pagination.pages <= 1) {
                console.log('只有一页，隐藏分页');
                paginationWrapper.style.display = 'none';
                return;
            }
            
            console.log('显示分页控件');
            // 显示分页容器
            paginationWrapper.style.display = 'flex';
            
            // 更新统计信息
            if (paginationStats) {
                const start = (pagination.current_page - 1) * pagination.per_page + 1;
                const end = Math.min(pagination.current_page * pagination.per_page, pagination.total);
                paginationStats.textContent = `显示第 ${start} - ${end} 条，共 ${pagination.total} 条记录`;
                console.log('统计信息已更新');
            }
            
            // 生成分页按钮
            let paginationHtml = '';
            
            // 上一页
            if (pagination.has_prev) {
                paginationHtml += `
                    <li class="page-item">
                        <a class="page-link" href="#" onclick="alert('上一页')">
                            <i class="bi bi-chevron-left"></i>
                        </a>
                    </li>
                `;
            } else {
                paginationHtml += `
                    <li class="page-item disabled">
                        <span class="page-link"><i class="bi bi-chevron-left"></i></span>
                    </li>
                `;
            }
            
            // 页码
            for (let i = 1; i <= pagination.pages; i++) {
                if (i === pagination.current_page) {
                    paginationHtml += `
                        <li class="page-item active">
                            <span class="page-link">${i}</span>
                        </li>
                    `;
                } else {
                    paginationHtml += `
                        <li class="page-item">
                            <a class="page-link" href="#" onclick="alert('第${i}页')">${i}</a>
                        </li>
                    `;
                }
            }
            
            // 下一页
            if (pagination.has_next) {
                paginationHtml += `
                    <li class="page-item">
                        <a class="page-link" href="#" onclick="alert('下一页')">
                            <i class="bi bi-chevron-right"></i>
                        </a>
                    </li>
                `;
            } else {
                paginationHtml += `
                    <li class="page-item disabled">
                        <span class="page-link"><i class="bi bi-chevron-right"></i></span>
                    </li>
                `;
            }
            
            paginationContainer.innerHTML = paginationHtml;
            console.log('分页HTML已更新:', paginationHtml);
        }
    </script>
</body>
</html> 